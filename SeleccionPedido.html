<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">

<head>


   <meta name="apple-mobile-web-app-capable" content="yes" />
   <meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1.0, maximum-scale=1.0"/>

    <link rel="stylesheet" href="jquery.mobile-1.1.0/jquery.mobile-1.1.0.min.css" />
    <link rel="stylesheet" href="jquery.mobile-1.1.0/jquery-mobile-960.min.css" />
    <link type="text/css" href="jquery.mobile-1.1.0/jqm-datebox-1.1.0.min.css" rel="stylesheet" /> 

    <script type="text/javascript" src="jquery.mobile-1.1.0/jquery-1.7.1.min.js"></script>
    <script type="text/javascript" src="jquery.mobile-1.1.0/jquery.mobile-1.1.0.min.js"></script>

    <script language="javascript" type="text/javascript" src="SBODatabase.js"></script>
 

<script type="text/javascript">

    var fromPage;
    var Cliente;

    $("#pagesel").live("pageinit", function (event) {

        fromPage = GetStorageValue("From");
        Cliente = GetStorageValue("ClientePedido"); 

        var myDB = OpenDatabase(successfunction, errorfunction);


            var sTextDiscount, dQuantity, dPrice, dDiscount, dTotalLinea;
            var iLine;
            var sTotal, sId, sVisita, sCliente, sNombre, sFecha;

            $.mobile.loadingMessageTextVisible = true;
            $.mobile.showPageLoadingMsg("a", "Seleccionando Pedidos...", false);

            myDB.transaction(function (tx) {

                tx.executeSql("select T0.*,T1.CardName from AX_ORDR T0 LEFT OUTER JOIN AX_OCRD T1 ON T0.CardCode = T1.CardCode WHERE T0.CardCode=?", [Cliente], function (tx, result) {
                    dataset = result.rows;

                    $('#lvPedidos').empty();
                    $("#lvPedidos").append('<li data-role="list-divider"><div class="container_12"><div class="grid_2">Pedido</div><div class="grid_2">Cliente</div><div class="grid_4">Nombre</div><div class="grid_2">Fecha</div><div class="grid_2">Total</div></div></li>');

                    for (var i = 0; i < result.rows.length; i++) {

                        iLine = i + 1;

                        sId = result.rows.item(i)['Id'].toString();
                        sVisita = result.rows.item(i)['IdVisita'].toString();
                        sCliente = result.rows.item(i)['CardCode'].toString();
                        sNombre = result.rows.item(i)['CardName'].toString();
                        sFecha = result.rows.item(i)['Date'].toString();

                        if (result.rows.item(i)['Total'] != null)
                            sTotal = result.rows.item(i)['Total'].toString();
                        else sTotal = "0";

                        $("#lvPedidos").append('<li><a href="javascript:SelectValue(\'' + sId + '\');" data-ajax="false"/><div class="container_12"><div class="grid_2">' + sId.toString() + '</div><div class="grid_2">' + sCliente.toString() + '</div><div class="grid_4">' + sNombre.toString() + '</div><div class="grid_2">' + sFecha.toString() + '</div><div class="grid_2">' + sTotal.toString() + '</div></div></li>');
                    }

                    $('#lvPedidos').listview('refresh', true);
                    $("#pagesel").trigger("create");

                });
            });
    });

    function SelectValue(sValue) {
        localStorage['Pedido'] = sValue;
        window.location.assign(fromPage + ".html");
    }

    function queryString(parameter) {
        var loc = location.search.substring(1, location.search.length);
        var param_value = false;
        var params = loc.split("&");
        for (i = 0; i < params.length; i++) {
            param_name = params[i].substring(0, params[i].indexOf('='));
            if (param_name == parameter) {
                param_value = params[i].substring(params[i].indexOf('=') + 1)
            }
        }
        if (param_value) {
            return param_value;
        }
        else {
            return null;
        }
    }

    function successfunction() {
        $.mobile.hidePageLoadingMsg();
    }

    function errorfunction(e) {
        if (e == DOMException.INVALID_STATE_ERR) {

            alert("Invalid database version.");
        } else {
            alert("Unknown error " + e + ".");
        }
        $.mobile.hidePageLoadingMsg();
    }

    function GetStorageValue(sKey) {
        var value;
        value = localStorage[sKey];
        localStorage.removeItem(sKey);

        if (value == "null")
            value = null;

        return value;
    }
 </script> 

</head>


<body>

        <div data-role="page" id="pagesel" data-theme="c" data-title="Seleccion de Pedido" >

	        <div data-role="header">
	            <a data-rel="back" data-icon ="back">Anterior</a>
	            <h1>Selección Pedido</h1>
            </div>


	        <div data-role="content" id ="content" >	
		        
                    <ul data-role='listview' data-mini="true" data-inset='true' data-filter="true" data-filter-placeholder="Buscar Pedidos..." id='lvPedidos'>

                    </ul>
            </div> 

                 <div data-role="footer" data-theme="c" data-position="fixed">
                     <div align="center" style = "background-color: #243758; font-size:12px;"><img src="images/logo.png" alt="Ferrer"/> </div>

                </div>

        </div>

 
</body>
</html>
